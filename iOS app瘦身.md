# iOS app应用瘦身
### 可执行文件瘦身
#### 编译时选项
1. **编译器优化级别**  
Build Settings->Optimization Level有几个编译优化选项，release版应该选择Fastest, Smalllest，这个选项会开启那些不增加代码大小的全部优化，并让可执行文件尽可能小。  
2.  **去除符号信息**  
Strip Linked Product / Deployment Postprocessing / Symbols Hidden by Default 在release版本应该设为yes，可以去除不必要的调试符号。Symbols Hidden by Default会把所有符号都定义成”private extern”，详细信息见官方文档。
3.  **删除无用代码**  
在项目里新建一个类，给它添加几个方法，但不要在任何地方import它，build完项目后观察linkmap，你会发现这个类还是被编译进可执行文件了。  
按C++的经验，没有被使用到的类和方法编译器都会优化掉，不会编进最终的可执行文件，但object-c不一样，因为object-c的动态特性，它可以通过类和方法名反射获得这个类和方法进行调用，所以就算在代码里某个类没被使用到，编译器也没法保证这个类不会在运行时通过反射去调用，所以只要是在项目里的文件，无论是否又被使用到都会被编译进可执行文件。   
对此我们可以通过脚本，遍历整个项目的文件，找出所有没有被引用的类文件和没有被调用的方法，在保证没有其他地方动态调用的情况下把它们去掉。如果整个项目历时很长，历时代码遗留较多，这个清理对可执行文件省出的空间还是挺可观的。
4.  **类和方法名长度**  
每个类和方法名都会在__csstring段里存在相应的字符串值，一定程度上会增加可执行文件的大小。可以对类和方法名进行混淆，但使用成本较大。
5.  **冗余字符串**  
代码中定义的所有静态字符串也会记录在可执行文件的__cstring段。
#### 图片优化
1.  去除项目中没有用的图片  
使用LSUnusedResources对项目进行分析，罗列没有使用的图片，但是可能会误伤，需要开发者进行确认。
2.  压缩项目中的图片资源  
可以使用ImageOptim工具对图片进行压缩。
#### 可执行文件优化
1.  删除不用的类和文件。
2.  使用脚本工具和linkmap文件分析项目中各个静态库和framework的大小。找出可能的优化模块。
#### 优化示意图
![image description](http://p1.bpimg.com/567571/3dae12baba0a5943.png)